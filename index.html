<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>168th Station Heat Data</title>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      padding: 20px;
      background-color: #1b1b1b;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      color: #eee;
    }
    h2 {
      color: #eee;
      font-size: 20px;
      margin-top: 40px;
      border-bottom: 1px solid #333;
    }
    .chart-container {
      width: 100%;
      max-width: 1000px;
      margin: auto;
    }
    #tempChart, #excessChart {
      width: 100%;
      height: 400px;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<div class="chart-container">
  <h2>Temperature and Heat Index</h2>
  <div id="tempChart"></div>

  <h2>Heat Excess (Heat Index - Temp)</h2>
  <div id="excessChart"></div>
</div>

<script>
  Highcharts.setOptions({
    chart: {
      backgroundColor: '#1b1b1b',
      style: { fontFamily: 'Helvetica Neue, Arial, sans-serif' }
    },
    xAxis: {
      labels: { style: { color: '#ccc' } },
      gridLineColor: '#333',
      lineColor: '#444',
      tickColor: '#444'
    },
    yAxis: {
      labels: { style: { color: '#ccc' } },
      title: { style: { color: '#eee' } },
      gridLineColor: '#333'
    },
    legend: {
      itemStyle: { color: '#eee' },
      itemHoverStyle: { color: '#fff' }
    },
    tooltip: {
      backgroundColor: '#333',
      borderColor: '#777',
      style: { color: '#fff' }
    }
  });

  function syncExtremes(e) {
    const thisChart = this.chart;
    Highcharts.charts.forEach(chart => {
      if (chart !== thisChart && chart && chart.xAxis[0].setExtremes) {
        chart.xAxis[0].setExtremes(e.min, e.max, true, false);
      }
    });
  }

  function parseCSVRow(row) {
    const [time, temp, heat] = row.split(',');
    return {
      time: new Date(time).getTime(),
      temp: parseFloat(temp),
      heat: parseFloat(heat)
    };
  }

  fetch('168_station_data.csv')
    .then(response => response.text())
    .then(csv => {
      const rows = csv.trim().split('\n').slice(1);
      const data = rows.map(parseCSVRow);

      const tempData = data.map(d => [d.time, d.temp]);
      const heatData = data.map(d => [d.time, d.heat]);
      const excessData = data.map(d => [d.time, d.heat - d.temp]);

      Highcharts.chart('tempChart', {
        chart: {
          zoomType: 'x',
          panning: true,
          panKey: 'shift'
        },
        title: { text: '' },
        xAxis: {
          type: 'datetime',
          crosshair: true,
          events: { setExtremes: syncExtremes },
          title: { text: 'Time' }
        },
        yAxis: { title: { text: '°F' } },
        tooltip: { shared: true },
        series: [
          { name: 'Temperature', data: tempData, color: '#00c1d5' },
          { name: 'Heat Index', data: heatData, color: '#ff6f61' }
        ]
      });

      Highcharts.chart('excessChart', {
        chart: {
          type: 'area',
          zoomType: 'x',
          panning: true,
          panKey: 'shift'
        },
        title: { text: '' },
        xAxis: {
          type: 'datetime',
          crosshair: true,
          events: { setExtremes: syncExtremes },
          title: { text: 'Time' }
        },
        yAxis: { title: { text: 'Excess (°F)' } },
        tooltip: { shared: true },
        series: [{
          name: 'Heat Excess',
          data: excessData,
          color: '#9b59b6',
          fillOpacity: 0.5
        }]
      });
    });
</script>

</body>
</html>
